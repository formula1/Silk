<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: fork/fork_container/Fork2Server_com.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: fork/fork_container/Fork2Server_com.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var path = require("path");
global.__root = path.resolve(__dirname,"../../../");
var MessageRouter = require(__root+"/core/abstract/MessageRouter.js");
var ForkUser = require(__dirname+"/user_puppet.js");

var users = {};
var forkname = process.env.start.substring((__root+"/apps").length).split("/").splice(1,1)[0];
console.log("name: "+forkname);
console.log("in the child");


/**
  Is the forks private router. its available at a global scope. A fork internal
  implementation of {@linkcode http://nodejs.org/api/child_process.html#child_process_child_send_message_sendhandle}

  @var {MessageRouter} methods
  @memberof ServerSide

*/
var methods = new MessageRouter(function(message){
  process.send({cmd:"send",message:message});
});

methods.on("add",function(key,fn){
  process.send({cmd:"add",key:key});
});

methods.on("remove",function(key,fn){
  process.send({cmd:"remove",key:key});
});

process.on("message",function(message){
  console.log(message.name);
  switch(message.cmd){
    case "disconnect": message.user.emit("close"); break;
    case "close": break; //expected to close, will close forcfully in 5 seconds
    case "sleep": break; //Head is removed from the window manager so updates are impossible
    case "minimize": break; //Head is not removed but updates to the head will not be seen
    default:
      if(!(message.user in users))
        users[message.user] = new ForkUser(message.user);
      message.user  = users[message.user];
      methods.routeMessage(message,message.user);
  }
});

// make global because it will be used in most files.
global.methods = methods;

process.nextTick(function(){
  require(process.env.start);
})

process.send({cmd:"ready"});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="ClientSide.FrameContext.html">FrameContext</a></li><li><a href="ClientSide.NetworkHost.html">NetworkHost</a></li><li><a href="ClientSide.NetworkInstance.html">NetworkInstance</a></li><li><a href="ClientSide.Server.html">Server</a></li><li><a href="ClientSide.WinAbs.html">WinAbs</a></li><li><a href="ClientSide.WindowManager.html">WindowManager</a></li><li><a href="ServerSide.AppFactory.html">AppFactory</a></li><li><a href="ServerSide.Server2Client.html">Server2Client</a></li><li><a href="ServerSide.Server2Fork.html">Server2Fork</a></li><li><a href="StreamPromise.html">StreamPromise</a></li><li><a href="User.html">User</a></li></ul><h3>Namespaces</h3><ul><li><a href="ClientSide.html">ClientSide</a></li><li><a href="ServerSide.html">ServerSide</a></li></ul><h3>Interfaces</h3><ul><li><a href="MessageDuplex.html">MessageDuplex</a></li><li><a href="MessageRouter.html">MessageRouter</a></li><li><a href="MessageWriter.html">MessageWriter</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha10</a> on Thu Nov 27 2014 12:54:03 GMT-0800 (PST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
