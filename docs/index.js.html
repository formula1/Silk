<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var domain = require('domain');
var AF = require(__dirname+'/fork/AppFactory.js')
var filesniff = require(__dirname+"/utils/filesniffer");
var windows;
var jspath = require(__dirname+"/abstract/jspath-chain");
var express = require("express");
var fs = require("fs");
var Server2Client = require(__root+"/core/Server2Client_com.js");

/**
These are all the ServerSide IO implementations available to core and/or app developers.

@namespace ServerSide
*/

module.exports = function(app){
  /**
  Is the Global Servserside router of websocket events

  @var {Server2Client} ClientEmitter
  @memberof ServerSide

  */
  global.ClientEmitter = new Server2Client(9999);

  app.get('/', function (req, res) {
    res.sendFile(__dirname+'/utils/manager/public/index.html');
  })
  console.log("compiling forks");
  windows = new AF(__root+"/apps/","/",app);

  windows.on("finishedCompiling", function(results){
    for(var i in windows.hashmap)
      if(windows.hashmap[i].fork)
        windows.hashmap[i].fork.send({user:"Server",name:"windows",data:windows.clean});
    console.log("\nThese Windows were completed: "+ JSON.stringify(results));
  });
  windows.on("forked", function(fork){
    fork.on("error",function(err){
      console.log(fork.pid+e);
    });
    fork.on("close",function(code,signal){
      console.log("child is closed");
    });
    fork.on("disconnect",function(){
      console.log("child disconnected")
    })
  })
  console.log("setting up default publics");
  app.use("/abstract", express.static(__root+"/core/abstract"));
  ["fork","network","user","window"].forEach(function(folder){
    app.use("/"+folder, express.static(__root+"/core/"+folder+"/public"));
  })
  console.log("setting up utils publics");
  fs.readdirSync(__root+"/core/utils").forEach(function(folder){
    app.use("/utils/"+folder, express.static(__root+"/core/utils/"+folder+"/public"));
  })
  console.log("bower and browserify statics");
  app.get(/^\/bc\/.*/,require(__root+"/core/bower_static.js"));
  app.get(/^\/nm\/.*/,require(__root+"/core/browserify_static.js"));
  app.get("/api.js",require(__root+"/core/client_api.js"));

  ClientEmitter.add("applications",function(message,callob,next){
    if(!message || !message.jspath){
      return windows.clean;
    }
    return jspath(message.jspath,windows.clean).get();
  })

  app.get("/filesniffer",function(req,res,next){
    var d = domain.create();
    d.on('error', function(er) {
      return next(er);
    })
    d.run(function() {
      filesniff(req.query.file,function(err,sniffed){
        if(err) return next(err);
        res.type("json").send(sniffed);
      });
    });
  })

}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="ClientSide.FrameContext.html">FrameContext</a></li><li><a href="ClientSide.NetworkHost.html">NetworkHost</a></li><li><a href="ClientSide.NetworkInstance.html">NetworkInstance</a></li><li><a href="ClientSide.Server.html">Server</a></li><li><a href="ClientSide.WinAbs.html">WinAbs</a></li><li><a href="ClientSide.WindowManager.html">WindowManager</a></li><li><a href="ServerSide.AppFactory.html">AppFactory</a></li><li><a href="ServerSide.Server2Client.html">Server2Client</a></li><li><a href="ServerSide.Server2Fork.html">Server2Fork</a></li><li><a href="StreamPromise.html">StreamPromise</a></li><li><a href="User.html">User</a></li></ul><h3>Namespaces</h3><ul><li><a href="ClientSide.html">ClientSide</a></li><li><a href="ServerSide.html">ServerSide</a></li></ul><h3>Interfaces</h3><ul><li><a href="MessageDuplex.html">MessageDuplex</a></li><li><a href="MessageRouter.html">MessageRouter</a></li><li><a href="MessageWriter.html">MessageWriter</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha10</a> on Thu Nov 27 2014 12:42:56 GMT-0800 (PST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
